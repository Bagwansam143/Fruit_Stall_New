<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madina Fruits - Fresh Delivery</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');

        :root {
            --glass: rgba(255, 255, 255, 0.2);
            --blur: blur(15px);
            --border: rgba(255, 255, 255, 0.3);
        }

        body {
            margin: 0;
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            color: white;
            padding-bottom: 100px;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Header Section */
        header {
            padding: 40px 10px 20px 10px;
            text-align: center;
        }

        header h1 {
            font-size: 3.5rem; /* Bada naam */
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 0;
            text-shadow: 3px 5px 15px rgba(0,0,0,0.3);
        }

        /* Boxy Nav - Header ke niche */
        .nav-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-container a {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            color: white;
            text-decoration: none;
            padding: 10px 25px;
            font-weight: 600;
            border-radius: 12px; /* Boxy shape */
            text-transform: uppercase;
            transition: 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .nav-container a:hover {
            transform: translateY(-10px) rotate(1deg); /* Hover par thoda tilt hoga */
background: rgba(255, 255, 255, 0.36);
box-shadow: 0 40px 80px rgba(0, 0, 0, 0.20);
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            padding: 20px;
        }

        .fruit-card {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 20px;
            width: 280px;
            text-align: center;
            transition: 0.3s;
        }

        .fruit-card img {
            width: 100%;
            height: 200px;
            object-fit: fit;
            border-radius: 15px;
        }


.fruit-card:hover {
transform: translateY(-20px) rotate(2deg); /* Hover par thoda tilt hoga */
background: rgba(255, 255, 255, 0.36);
box-shadow: 0 40px 80px rgba(0, 0, 0, 0.20);
}

        .qty-box {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .qty-btn {
            background: white;
            color: #333;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        #order-bar {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            cursor: pointer;
        }

/* Checkout Form Modal */
.modal {
    display: none; 
    position: fixed; 
    z-index: 5000; 
    left: 0; top: 0; width: 100%; height: 100%; 
    background: rgba(0, 0, 0, 0.4); /* Piche ka parda halka dark */
    backdrop-filter: blur(10px); /* Piche ka background blur karega */
}

.modal-content {
    background: rgba(255, 255, 255, 0.52); /* Glass effect */
    backdrop-filter: blur(20px);
    margin: 10% auto; 
    padding: 30px; 
    width: 85%; max-width: 400px; 
    border-radius: 30px; 
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white; /* Text white rakhenge glass par achha lagta hai */
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    text-align: center;
}

.modal-content h2 { 
    font-weight: 700; 
    margin-bottom: 20px;
    text-shadow: 0 2px 4px rgba(0.2,0,0,0.25);
}


.modal-content input, .modal-content textarea {
    width: 100%; padding: 12px; margin: 10px 0; 
    border-radius: 12px; border: 1px solid #ddd;
    box-sizing: border-box; font-family: 'Outfit', sans-serif;
    font-size: 1rem;
}

.btn-confirm {
    background: #25d366; color: white; border: none; 
    width: 65%; padding: 15px; border-radius: 12px;
    font-weight: bold; cursor: pointer; font-size: 1.1rem;
    margin-top: 10px; transition: 0.3s;
}

.btn-confirm:hover { background: #128c7e; transform: scale(1.02); }
    </style>
</head>
<body>

    <header>
        <h1> üçé AK Fruits</h1>
    </header>

    <div class="nav-container">
        <a href="homepage.html">üè† Home</a>
        <a href="login.html">‚öôÔ∏è Admin</a>
    </div>

    <div class="container" id="fruit-list">
        <h3 id="loader">Database se connect ho raha hai...</h3>
    </div>

    <div id="order-bar" onclick="window.sendWhatsApp()">
        <div><span id="cart-count">0</span> Items | ‚Çπ<span id="cart-total">0</span></div>
        <strong>ORDER NOW ‚Üí</strong>
    </div>

    <script>
        // --- LOGIC MEIN KOI CHANGE NAHI HAI ---
        const firebaseConfig = {
            apiKey: "AIzaSyAVGLFFYJCkfAi94Y4MuXXNlOqoK9FTbAg",
            authDomain: "fruitstall-b7ec5.firebaseapp.com",
            databaseURL: "https://fruitstall-b7ec5-default-rtdb.firebaseio.com",
            projectId: "fruitstall-b7ec5",
            appId: "1:327620665688:web:7f21a399b715c98746c52d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let cart = {};

        db.ref('fruits/').on('value', (snap) => {
            const listDiv = document.getElementById('fruit-list');
            if (!listDiv) return;
            listDiv.innerHTML = ''; 
            if(!snap.exists()) {
                listDiv.innerHTML = "<h3>Shop khali hai!</h3>";
                return;
            }
            snap.forEach((child) => {
                const f = child.val();
                const id = child.key;
                listDiv.innerHTML += `
                    <div class="fruit-card">
                        <img src="${f.img || 'https://via.placeholder.com/150'}">
                        <h3>${f.name}</h3>
                        <p>‚Çπ${f.price} / ${f.unit}</p>
                        <div class="qty-box">
                            <button class="qty-btn" onclick="window.changeQty('${id}', '${f.name}', ${f.price}, -0.5)">-</button>
                            <span id="qty-${id}" style="font-size:20px; font-weight:bold;">0</span>
                            <button class="qty-btn" onclick="window.changeQty('${id}', '${f.name}', ${f.price}, 0.5)">+</button>
                        </div>
                    </div>`;
            });
        });

        window.changeQty = function(id, name, price, change) {
            if(!cart[id]) cart[id] = { name: name, price: price, qty: 0 };
            cart[id].qty += change;
            if(cart[id].qty < 0) cart[id].qty = 0;
            document.getElementById('qty-' + id).innerText = cart[id].qty;
            let tQty = 0, tPrice = 0;
            for(let key in cart) {
                tQty += cart[key].qty;
                tPrice += (cart[key].qty * cart[key].price);
            }
            document.getElementById('cart-count').innerText = tQty;
            document.getElementById('cart-total').innerText = tPrice;
            document.getElementById('order-bar').style.display = (tQty > 0) ? 'flex' : 'none';
        };

       // Step 1: Jab user 'Order Now' bar par click kare
window.sendWhatsApp = function() {
    // Form kholne se pehle check karein ki cart khali toh nahi
    let tQty = document.getElementById('cart-count').innerText;
    if(tQty == "0") {
        alert("Bhai, pehle kuch fruit toh select karo!");
        return;
    }



    document.getElementById('checkoutModal').style.display = 'block';
};

// Step 2: Form bharne ke baad final send logic
window.finalSend = function() {

// 1. Pehle Total Bill Check Karo
    let currentTotal = 0;
    for(let id in cart) {
        if(cart[id].qty > 0) {
            currentTotal += (cart[id].qty * cart[id].price);
        }
    }

    // 2. Agar Total 499 se kam hai toh aage mat badhne do
    if(currentTotal < 499) {
        alert("Bhai, Minimum order value ‚Çπ499 honi chahiye!\n\nAapka abhi ka total ‚Çπ" + currentTotal + " hai.\nKripya kuch aur items add karein.");
        document.getElementById('checkoutModal').style.display = 'none'; // Modal band kar do taaki wo aur shopping kar sake
        return;
    }
    const cName = document.getElementById('custName').value.trim();
    const cPhone = document.getElementById('custPhone').value.trim();
    const cAddress = document.getElementById('custAddress').value.trim();
    const cPincode = document.getElementById('custPincode').value.trim();

    // Aapke Delivery Areas
    const allowedPincodes = ["425201", "425202", "123456"]; 

    if(!cName || cPhone.length !== 10 || !cAddress || !cPincode) {
        alert("Bhai, saari details aur 10 digit number sahi se bhariye!");
        return;
    }

    if(!allowedPincodes.includes(cPincode)) {
        alert("Maafi chahte hain! Hum abhi is area mein delivery nahi dete.");
        return;
    }

    let msg = "NEW ORDER - Ak FRUITS\n";
    msg += "------------------------------\n";
    msg += "üë§ Name: " + cName + "\n";
    msg += "üìû Phone: " + cPhone + "\n";
    msg += "üìç Address: " + cAddress + " - " + cPincode + "\n";
    msg += "------------------------------\n\n";
    msg += "ORDER ITEMS: \n";

    let total = 0;
    for(let id in cart) {
        if(cart[id].qty > 0) {
            // Smart Logic: Card ke text se Unit (kg/dozen) nikalna
            let cardElement = document.getElementById('qty-' + id).closest('.fruit-card');
            let unitText = cardElement.querySelector('p').innerText; 
            let unit = unitText.split('/').pop().trim(); // "‚Çπ100 / kg" se "kg" nikal lega

            msg += "‚Ä¢ " + cart[id].name + " [" + cart[id].qty + " " + unit + "]\n";
            total += (cart[id].qty * cart[id].price);
        }
    }

 

    msg += "\n‚≠ê Total Bill: ‚Çπ" + total + "\n";
    msg += "------------------------------\n";
    msg += "Kripya order confirm karein!";

    const myNumber = "919767105224"; 
    const url = "https://wa.me/" + myNumber + "?text=" + encodeURIComponent(msg);
    
    window.open(url, '_blank');
    document.getElementById('checkoutModal').style.display = 'none';
};
    </script>

<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <h2>üìã Delivery Details</h2>
        <p style="color: #666; font-size: 0.9rem;">Please provide your details to complete the order.</p>
        
        <input type="text" id="custName" placeholder="Aapka Naam" required>
        <input type="tel" id="custPhone" placeholder="Mobile Number (10 Digits)" 
       pattern="[0-9]{10}" maxlength="10" 
       oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
        <textarea id="custAddress" placeholder="Pura Address (Gully, Landmark, Area)" rows="3" required></textarea>
	<input type="tel" id="custPincode" placeholder="Pincode" 
       pattern="[0-9]{10}" maxlength="6"
       oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
        
        <button class="btn-confirm" onclick="finalSend()"> Confirm Order ‚úÖ</button>
        
        <p onclick="document.getElementById('checkoutModal').style.display='none'" style="text-align:center; color: white; margin-top:15px; cursor:pointer; font-size: 1rem;">Back to Shop</p>
    </div>
</div>
</body>
</html>
